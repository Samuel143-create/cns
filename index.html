<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CNS â€“ Resultados Electorales</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #003366;
}
.card {
  background: white;
  padding: 20px;
  margin: 20px auto;
  border-radius: 14px;
  max-width: 900px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
button {
  padding: 10px 18px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background: #003366;
  color: white;
}
button:hover {
  background: #0055aa;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
}
th {
  background: #003366;
  color: white;
}
.progress {
  background: #e0e0e0;
  border-radius: 10px;
  overflow: hidden;
  height: 12px;
}
.bar {
  height: 12px;
  background: #003366;
}
.small {
  font-size: 12px;
  color: gray;
}
</style>
</head>

<body>

<h1>Consejo Nacional Samuel (CNS)</h1>

<!-- ESTADO -->
<div class="card">
  <button onclick="actualizar()">ðŸ”„ Actualizar ahora</button>
  <p id="estado">Cargando datos...</p>
  <p class="small">
    ActualizaciÃ³n automÃ¡tica cada 5 minutos.<br>
    Datos transcritos manualmente desde el sitio oficial del CNE.
  </p>
</div>

<!-- ACTAS -->
<div class="card">
  <h2>EstadÃ­sticas de Actas</h2>
  <p>Total: <strong id="actasTotal"></strong></p>
  <p>Correctas: <strong id="actasCorrectas"></strong></p>
  <p>Inconsistentes: <strong id="actasInconsistentes"></strong></p>
</div>

<!-- RESULTADOS -->
<div class="card">
  <h2>Resultados Presidenciales</h2>
  <table>
    <thead>
      <tr>
        <th>Partido</th>
        <th>Candidato</th>
        <th>Votos</th>
        <th>%</th>
      </tr>
    </thead>
    <tbody id="tablaResultados"></tbody>
  </table>
</div>

<!-- LIVE -->
<div class="card">
  <h2>Live CNE â€“ Escrutinio Especial</h2>
  <iframe
    width="100%"
    height="360"
    src="https://www.youtube.com/embed/https://www.youtube.com/watch?v=SyFtDMkX8Zg"
    frameborder="0"
    allowfullscreen>
  </iframe>
</div>

<script>
async function actualizar() {
  document.getElementById("estado").innerText = "Cargando datos...";

  try {
    const res = await fetch("resultados.json?_=" + Date.now());
    const data = await res.json();

    // Estado
    document.getElementById("estado").innerText =
      "Ãšltima actualizaciÃ³n: " + data.ultimaActualizacion;

    // Actas
    document.getElementById("actasTotal").innerText = data.actas.total;
    document.getElementById("actasCorrectas").innerText = data.actas.correctas;
    document.getElementById("actasInconsistentes").innerText = data.actas.inconsistentes;

    // Tabla resultados
    const tbody = document.getElementById("tablaResultados");
    tbody.innerHTML = "";

    const totalVotos = data.partidos.reduce((s, p) => s + p.votos, 0);

    data.partidos.forEach(p => {
      const porcentaje = ((p.votos / totalVotos) * 100).toFixed(2);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.nombre}</td>
        <td>${p.candidato}</td>
        <td>${p.votos.toLocaleString()}</td>
        <td>
          ${porcentaje}%
          <div class="progress">
            <div class="bar" style="width:${porcentaje}%"></div>
          </div>
        </td>
      `;
      tbody.appendChild(tr);
    });

  } catch (e) {
    document.getElementById("estado").innerText = "Error al cargar datos";
  }
}

// Carga inicial
actualizar();

// Auto-actualizaciÃ³n cada 5 minutos
setInterval(actualizar, 300000);
</script>

</body>
</html>
