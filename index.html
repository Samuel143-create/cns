<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CNS – Resultados Electorales</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<h1>Consejo Nacional Samuel (CNS)</h1>

<div class="card">

  <p class="total">
    <strong>Total de votos válidos:</strong>
    <span id="total-votos">Cargando…</span>
  </p>

  <div id="sello" class="sello preliminar">
    RESULTADOS PRELIMINARES
  </div>

  <table id="tabla-resultados">
    <tr>
      <th>Partido</th>
      <th>Candidato</th>
      <th>Votos</th>
      <th>Porcentaje</th>
    </tr>

    <tr data-votos="1298835">
      <td><img src="" width="30"> PARTIDO NACIONAL</td>
      <td>NASRY JUAN ASFURA</td>
      <td>1,298,835</td>
      <td class="grafica"><div class="barra"><span></span></div></td>
    </tr>

    <tr data-votos="1256428">
      <td><img src="" width="30"> PARTIDO LIBERAL</td>
      <td>SALVADOR NASRALLA</td>
      <td>1,256,428</td>
      <td class="grafica"><div class="barra"><span></span></div></td>
    </tr>

    <tr data-votos="618448">
      <td><img src="" width="30"> LIBRE</td>
      <td>RIXI MONCADA</td>
      <td>618,448</td>
      <td class="grafica"><div class="barra"><span></span></div></td>
    </tr>

    <tr data-votos="25421">
      <td><img src="" width="30"> PINU</td>
      <td>JORGE ÁVILA</td>
      <td>25,421</td>
      <td class="grafica"><div class="barra"><span></span></div></td>
    </tr>

    <tr data-votos="5516">
      <td><img src="" width="30"> DC</td>
      <td>MARIO RIVERA</td>
      <td>5,516</td>
      <td class="grafica"><div class="barra"><span></span></div></td>
    </tr>
  </table>
</div>

<!-- ===== GRÁFICA CIRCULAR ===== -->
<div class="card">
  <h2>Distribución de Votos</h2>
  <canvas id="graficaCircular" width="300" height="300"></canvas>
</div>

<!-- ===== LIVE ===== -->
<div class="card">
  <h2>Live CNE – Escrutinio Especial</h2>
  <iframe
    src="https://www.youtube.com/embed/SyFtDMkX8Zg"
    allowfullscreen>
  </iframe>
</div>

<!-- ===== FOOTER ===== -->
<div class="card footer">
  <p><strong>Última actualización:</strong> 2025-03-16 16:00</p>
  <p>Actualización automática cada 5 minutos.</p>
  <p>Datos transcritos manualmente desde el sitio oficial del CNE.</p>
</div>

<script>
  let filas = Array.from(document.querySelectorAll('#tabla-resultados tr[data-votos]'));

  // ordenar por votos
  filas.sort((a, b) => b.dataset.votos - a.dataset.votos);
  filas.forEach(f => f.parentNode.appendChild(f));

  let total = 0;
  let max = 0;
  let ganador = null;

  filas.forEach(fila => {
    const votos = parseInt(fila.dataset.votos);
    total += votos;
    if (votos > max) {
      max = votos;
      ganador = fila;
    }
  });

  document.getElementById('total-votos').textContent = total.toLocaleString();
  if (ganador) ganador.classList.add('ganador');

  filas.forEach(fila => {
    const votos = parseInt(fila.dataset.votos);
    const porcentaje = ((votos / total) * 100).toFixed(2);
    const span = fila.querySelector('.barra span');
    span.style.width = porcentaje + '%';
    span.textContent = porcentaje + '%';
  });

  // ===== GRÁFICA CIRCULAR =====
  const canvas = document.getElementById('graficaCircular');
  const ctx = canvas.getContext('2d');
  const colores = ['#003366','#0066cc','#cc0000','#ff9900','#666'];
  let inicio = 0;

  filas.forEach((fila, i) => {
    const votos = parseInt(fila.dataset.votos);
    const angulo = (votos / total) * Math.PI * 2;

    ctx.beginPath();
    ctx.moveTo(150,150);
    ctx.arc(150,150,140,inicio,inicio+angulo);
    ctx.fillStyle = colores[i % colores.length];
    ctx.fill();

    inicio += angulo;
  });

  // ===== MODO OSCURO AUTOMÁTICO =====
  const hora = new Date().getHours();
  if (hora >= 18 || hora < 6) {
    document.body.classList.add('oscuro');
  }
</script>

</body>
</html>
