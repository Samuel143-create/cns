<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CNS - Resultados Automáticos</title>
<style>
body { font-family: Arial; background: #f2f2f2; margin: 0; padding: 20px; }
h1 { text-align: center; color: #003366; }
.card { background: white; padding: 20px; margin: 20px auto; border-radius: 12px; max-width: 800px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);}
table { width: 100%; border-collapse: collapse; margin-top: 10px;}
th, td { padding: 10px; border-bottom: 1px solid #ddd;}
th { background: #003366; color: white;}
.bar-container { background: #ddd; border-radius: 8px; overflow: hidden; height: 24px; margin-bottom: 10px;}
.bar { height: 100%; text-align: right; padding-right: 8px; color: white; font-weight: bold; line-height: 24px; border-radius: 8px 0 0 8px;}
.bar.correctas { background: #28a745; }
.bar.inconsistentes { background: #dc3545; }
.bar.pendientes { background: #ffc107; color: #000;}
iframe { width: 100%; height: 400px; border: none; border-radius: 12px;}
</style>
</head>
<body>

<h1>Consejo Nacional Samuel (CNS) - Resultados Automáticos</h1>

<div class="card" id="resultados">
    <h2>Resultados Presidenciales</h2>
    <p>Cargando datos...</p>
</div>

<div class="card" id="actas">
    <h2>Estadísticas de Actas</h2>
    <p>Cargando datos...</p>
</div>

<div class="card">
    <h2>Live CNE - Cámaras de Escrutinio Especial</h2>
    <iframe id="live" src="" allowfullscreen></iframe>
</div>

<div class="card" id="fecha">
    <p><strong>Última actualización:</strong> </p>
</div>

<script>
async function cargarDatos() {
    try {
        const res = await fetch('datos.json', { cache: "no-store" });
        const data = await res.json();

        // Resultados presidenciales
        const divRes = document.getElementById('resultados');
        let tabla = `<table><tr><th>Partido</th><th>Candidato</th><th>Votos</th><th>%</th></tr>`;
        data.resultados.forEach(r => {
            tabla += `<tr>
                <td>${r.partido}</td>
                <td>${r.candidato}</td>
                <td>${r.votos.toLocaleString()}</td>
                <td>${r.porcentaje.toFixed(2)}%</td>
            </tr>`;
        });
        tabla += `</table>`;
        divRes.innerHTML = tabla;

        // Actas
        const divAct = document.getElementById('actas');
        const total = data.actas.total;
        divAct.innerHTML = `
            <p><strong>Total actas:</strong> ${total.toLocaleString()}</p>
            <p><strong>Correctas:</strong> ${data.actas.correctas.toLocaleString()}</p>
            <div class="bar-container">
                <div class="bar correctas" style="width:${(data.actas.correctas/total*100).toFixed(2)}%"> ${(data.actas.correctas/total*100).toFixed(2)}%</div>
            </div>
            <p><strong>Inconsistentes:</strong> ${data.actas.inconsistentes.toLocaleString()}</p>
            <div class="bar-container">
                <div class="bar inconsistentes" style="width:${(data.actas.inconsistentes/total*100).toFixed(2)}%"> ${(data.actas.inconsistentes/total*100).toFixed(2)}%</div>
            </div>
            <p><strong>Pendientes verificación visual:</strong> ${data.actas.pendientes.toLocaleString()}</p>
            <div class="bar-container">
                <div class="bar pendientes" style="width:${(data.actas.pendientes/total*100).toFixed(2)}%"> ${(data.actas.pendientes/total*100).toFixed(2)}%</div>
            </div>
        `;

        // Live CNE
        document.getElementById('live').src = data.live;

        // Fecha
        document.getElementById('fecha').innerHTML = `<p><strong>Última actualización:</strong> ${data.actualizacion}</p>`;

    } catch (err) {
        console.error('Error al cargar datos:', err);
    }
}

// Cargar al inicio
cargarDatos();

// Actualizar automáticamente cada 5 minutos
setInterval(cargarDatos, 300000);
</script>

</body>
</html>
